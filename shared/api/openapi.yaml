openapi: 3.0.3
info:
  title: Ada Fitness Tracker API
  description: API for the Ada fitness and nutrition tracking application
  version: 1.0.0
  contact:
    email: contact@ada-fitness.app

servers:
  - url: http://localhost:8000
    description: Development server
  - url: https://api.ada-fitness.app
    description: Production server

tags:
  - name: Authentication
    description: User authentication endpoints
  - name: User
    description: User profile and settings
  - name: Nutrition
    description: Meal and food tracking
  - name: Workouts
    description: Workout planning and logging
  - name: Tracking
    description: Weight, water, and steps tracking
  - name: AI
    description: AI assistant and vision analysis

paths:
  /auth/magic-link:
    post:
      tags: [Authentication]
      summary: Request magic link
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
              required: [email]
      responses:
        '200':
          description: Magic link sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  debug_link:
                    type: string

  /auth/verify:
    post:
      tags: [Authentication]
      summary: Verify magic link token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required: [token]
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'

  /auth/refresh:
    post:
      tags: [Authentication]
      summary: Refresh access token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required: [refresh_token]
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'

  /user/profile:
    get:
      tags: [User]
      summary: Get user profile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
    put:
      tags: [User]
      summary: Update user profile
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserProfileUpdate'
      responses:
        '200':
          description: Updated profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'

  /user/targets/calculate:
    post:
      tags: [User]
      summary: Calculate macro targets
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MacroCalculateRequest'
      responses:
        '200':
          description: Calculated targets
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MacroTargets'

  /nutrition/meals:
    get:
      tags: [Nutrition]
      summary: List meals
      security:
        - bearerAuth: []
      parameters:
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: List of meals
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MealSummary'
    post:
      tags: [Nutrition]
      summary: Create meal
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MealCreate'
      responses:
        '201':
          description: Created meal
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Meal'

  /nutrition/foods/barcode/{barcode}:
    get:
      tags: [Nutrition]
      summary: Lookup product by barcode
      security:
        - bearerAuth: []
      parameters:
        - name: barcode
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OpenFoodFactsProduct'
        '404':
          description: Product not found

  /ai/chat:
    post:
      tags: [AI]
      summary: Chat with Ada assistant
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                conversation_id:
                  type: string
                include_context:
                  type: boolean
                  default: true
              required: [message]
      responses:
        '200':
          description: Chat response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'

  /ai/vision/analyze:
    post:
      tags: [AI]
      summary: Analyze food photo
      security:
        - bearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                image_base64:
                  type: string
                prompt:
                  type: string
              required: [image_base64]
      responses:
        '200':
          description: Vision analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VisionAnalyzeResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
        expires_in:
          type: integer
        user_id:
          type: string

    UserProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
        display_name:
          type: string
        sex:
          type: string
          enum: [male, female]
        birth_date:
          type: string
          format: date
        height_cm:
          type: number
        current_weight_kg:
          type: number
        activity_level:
          type: string
          enum: [sedentary, light, moderate, active, very_active]
        goal_type:
          type: string
          enum: [cut, maintain, bulk]
        goal_rate_kg_per_week:
          type: number

    UserProfileUpdate:
      type: object
      properties:
        display_name:
          type: string
        sex:
          type: string
        birth_date:
          type: string
          format: date
        height_cm:
          type: number
        current_weight_kg:
          type: number
        activity_level:
          type: string
        goal_type:
          type: string
        goal_rate_kg_per_week:
          type: number

    MacroCalculateRequest:
      type: object
      properties:
        sex:
          type: string
        age:
          type: integer
        height_cm:
          type: number
        weight_kg:
          type: number
        activity_level:
          type: string
        goal_type:
          type: string
        goal_rate_kg_per_week:
          type: number

    MacroTargets:
      type: object
      properties:
        id:
          type: string
          format: uuid
        calories:
          type: integer
        protein_g:
          type: number
        carbs_g:
          type: number
        fat_g:
          type: number
        fiber_g:
          type: number
        bmr:
          type: integer
        tdee:
          type: integer

    Meal:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        meal_type:
          type: string
        timestamp:
          type: string
          format: date-time
        total_calories:
          type: integer
        total_protein_g:
          type: number
        total_carbs_g:
          type: number
        total_fat_g:
          type: number
        items:
          type: array
          items:
            $ref: '#/components/schemas/FoodItem'

    MealSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        meal_type:
          type: string
        timestamp:
          type: string
          format: date-time
        total_calories:
          type: integer
        items_count:
          type: integer

    MealCreate:
      type: object
      required: [name, timestamp, items]
      properties:
        name:
          type: string
        meal_type:
          type: string
          default: other
        timestamp:
          type: string
          format: date-time
        items:
          type: array
          items:
            $ref: '#/components/schemas/FoodItemCreate'

    FoodItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        source:
          type: string
        grams:
          type: number
        calories:
          type: integer
        protein_g:
          type: number
        carbs_g:
          type: number
        fat_g:
          type: number

    FoodItemCreate:
      type: object
      required: [name, grams, calories, protein_g, carbs_g, fat_g]
      properties:
        name:
          type: string
        source:
          type: string
          default: manual
        grams:
          type: number
        calories:
          type: integer
        protein_g:
          type: number
        carbs_g:
          type: number
        fat_g:
          type: number

    OpenFoodFactsProduct:
      type: object
      properties:
        barcode:
          type: string
        name:
          type: string
        brand:
          type: string
        calories_per_100g:
          type: number
        protein_per_100g:
          type: number
        carbs_per_100g:
          type: number
        fat_per_100g:
          type: number

    ChatResponse:
      type: object
      properties:
        message:
          type: string
        role:
          type: string
        tool_calls:
          type: array
          items:
            type: object
        conversation_id:
          type: string
        model_used:
          type: string
        created_entries:
          type: array
          items:
            type: object

    VisionAnalyzeResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/VisionFoodItem'
        totals:
          type: object
          properties:
            calories:
              type: integer
            protein_g:
              type: number
            carbs_g:
              type: number
            fat_g:
              type: number
        confidence:
          type: number
        description:
          type: string
        disclaimer:
          type: string

    VisionFoodItem:
      type: object
      properties:
        name:
          type: string
        portion_description:
          type: string
        grams_estimate:
          type: number
        calories:
          type: integer
        protein_g:
          type: number
        carbs_g:
          type: number
        fat_g:
          type: number
        confidence:
          type: number
